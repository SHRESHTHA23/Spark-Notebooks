{"metadata":{"name":"Sanket_Patil_FDSDE1602 ","user_save_timestamp":"1970-01-01T05:30:00.000Z","auto_save_timestamp":"1970-01-01T05:30:00.000Z","language_info":{"name":"scala","file_extension":"scala","codemirror_mode":"text/x-scala"},"trusted":true,"customLocalRepo":null,"customRepos":null,"customDeps":null,"customImports":null,"customArgs":null,"customSparkConf":null},"cells":[{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"949155CBC3CF409D81669971E85CBFDC"},"cell_type":"code","source":"import org.apache.spark._\nimport org.apache.spark.SparkContext._\nimport org.apache.spark.rdd._\n","outputs":[{"name":"stdout","output_type":"stream","text":"import org.apache.spark._\r\nimport org.apache.spark.SparkContext._\r\nimport org.apache.spark.rdd._\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":1}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"1337D8A4A3D54B7E9CC7B4A27FB6FF67"},"cell_type":"code","source":"println(\"Change the file paths to the local whereever needed\")\nval ratings_data = sparkContext.textFile(\"C:/Users/sanket.patil/Downloads/ml-1m/ratings.dat\")\n                        .map(line => line.split(\"::\"))\n                        .map(rating => (rating(0).toInt,rating(1).toString, rating(2).toInt,rating(3).toLong))\n                      \n                               ","outputs":[{"name":"stdout","output_type":"stream","text":"Change the file paths to the local whereever needed\nratings_data: org.apache.spark.rdd.RDD[(Int, String, Int, Long)] = MapPartitionsRDD[309] at map at <console>:56\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":173}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"5A16CE0865794C9D8F8DF73310D390FF"},"cell_type":"code","source":"val movies_data_raw =sparkContext.textFile(\"C:/Users/sanket.patil/Downloads/ml-1m/movies.dat\")\nval movies_data= movies_data_raw.map(line => line.split(\"::\"))\n                            .map(movie => (movie(0).toInt,movie(1)))","outputs":[{"name":"stdout","output_type":"stream","text":"movies_data_raw: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[311] at textFile at <console>:55\r\nmovies_data: org.apache.spark.rdd.RDD[(Int, String)] = MapPartitionsRDD[313] at map at <console>:57\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":174}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"998187A66275415D902FC398A40C1C43"},"cell_type":"code","source":"val mapped_ratings = ratings_data.map{\n                      case (userid,movieid,rating,time) => (movieid, 1)\n                      }\n                      .reduceByKey(_+_)\n                      .collect()\n                      .sortBy(-_._2)\n                      .take(10)\n                  \n                 \n","outputs":[{"name":"stdout","output_type":"stream","text":"mapped_ratings: Array[(String, Int)] = Array((2858,3428), (260,2991), (1196,2990), (1210,2883), (480,2672), (2028,2653), (589,2649), (2571,2590), (1270,2583), (593,2578))\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":163}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"75D9A7432F6D4B0E9B4A45DF76A1F148"},"cell_type":"code","source":"val totalcount=sc.parallelize(mapped_ratings)\nval x=movies_data.join(totalcount).map{\n                                       case(x,(y,z))=>y\n                                      }\n\n                                  .collect()\nprintln(\"Top ten most viewed movies are :\")\nx.foreach(println)","outputs":[{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":4},{"name":"stdout","output_type":"stream","text":"Top ten most viewed movies are :\nJurassic Park (1993)\nStar Wars: Episode V - The Empire Strikes Back (1980)\nSaving Private Ryan (1998)\nStar Wars: Episode IV - A New Hope (1977)\nTerminator 2: Judgment Day (1991)\nSilence of the Lambs, The (1991)\nBack to the Future (1985)\nStar Wars: Episode VI - Return of the Jedi (1983)\nAmerican Beauty (1999)\nMatrix, The (1999)\ntotalcount: org.apache.spark.rdd.RDD[(Int, Int)] = ParallelCollectionRDD[27] at parallelize at <console>:62\nx: Array[String] = Array(Jurassic Park (1993), Star Wars: Episode V - The Empire Strikes Back (1980), Saving Private Ryan (1998), Star Wars: Episode IV - A New Hope (1977), Terminator 2: Judgment Day (1991), Silence of the Lambs, The (1991), Back to the Future (1985), Star Wars: Episode VI - Return of the Jedi (1983), American Beauty (1999), Matrix, The (1999))\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":4}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"71BB13A0EFFE4B5F8588216BCAB3921D"},"cell_type":"code","source":"val toprated_all=ratings_data.map{\n                               case (userid,movieid,rating,time) => ((movieid,rating),1)\n                             }\n                         .reduceByKey(_+_) \n                         .filter{\n                             case ((movieid,rating),count) => count > 40 && rating==5\n                         }\n                         .collect()\n                         .sortBy(-_._2)\n                         \n\n                         ","outputs":[{"name":"stdout","output_type":"stream","text":"toprated_all: Array[((String, Int), Int)] = Array(((2858,5),1963), ((260,5),1826), ((1198,5),1500), ((1196,5),1483), ((527,5),1475), ((858,5),1475), ((318,5),1457), ((2571,5),1430), ((2028,5),1405), ((2762,5),1385), ((593,5),1350), ((608,5),1278), ((110,5),1206), ((296,5),1193), ((1197,5),1186), ((50,5),1144), ((1210,5),1028), ((1617,5),1009), ((2997,5),1007), ((2396,5),987), ((912,5),984), ((356,5),945), ((589,5),942), ((1221,5),941), ((1193,5),937), ((541,5),898), ((1214,5),861), ((1136,5),859), ((919,5),847), ((1240,5),831), ((750,5),828), ((1213,5),823), ((1,5),820), ((1270,5),791), ((3578,5),773), ((924,5),757), ((1200,5),754), ((1097,5),747), ((3114,5),724), ((1265,5),703), ((1387,5),702), ((908,5),673), ((2959,5),661), ((923,5),658), ((2804,5),650), ((457,5),645), ((2324,5),634),..."},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":164}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"8B8B25E26F974ACAB3085EA5F7A52713"},"cell_type":"code","source":"val toprated=toprated_all.take(20)","outputs":[{"name":"stdout","output_type":"stream","text":"toprated: Array[((String, Int), Int)] = Array(((2858,5),1963), ((260,5),1826), ((1198,5),1500), ((1196,5),1483), ((527,5),1475), ((858,5),1475), ((318,5),1457), ((2571,5),1430), ((2028,5),1405), ((2762,5),1385), ((593,5),1350), ((608,5),1278), ((110,5),1206), ((296,5),1193), ((1197,5),1186), ((50,5),1144), ((1210,5),1028), ((1617,5),1009), ((2997,5),1007), ((2396,5),987))\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":165}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"666346A3F6E14297863740F365D52E62"},"cell_type":"code","source":"val highest_rated=toprated.map{\n   case ((movieid,rating),count) => (movieid,count)\n}\nval high_rated = sc.parallelize(highest_rated)\nval x=movies_data.join(high_rated).map{\n                                       case(x,(y,z))=>y\n                                      }\n\n                                  .collect()\nprintln(\"Top Twenty highest rated movies are :\")\nx.foreach(println)","outputs":[{"name":"stdout","output_type":"stream","text":"Top Twenty highest rated movies are :\nStar Wars: Episode V - The Empire Strikes Back (1980)\nShakespeare in Love (1998)\nFargo (1996)\nSaving Private Ryan (1998)\nStar Wars: Episode IV - A New Hope (1977)\nPulp Fiction (1994)\nPrincess Bride, The (1987)\nL.A. Confidential (1997)\nSilence of the Lambs, The (1991)\nBeing John Malkovich (1999)\nShawshank Redemption, The (1994)\nSixth Sense, The (1999)\nGodfather, The (1972)\nBraveheart (1995)\nRaiders of the Lost Ark (1981)\nStar Wars: Episode VI - Return of the Jedi (1983)\nAmerican Beauty (1999)\nUsual Suspects, The (1995)\nMatrix, The (1999)\nSchindler's List (1993)\nhighest_rated: Array[(Int, Int)] = Array((2858,1963), (260,1826), (1198,1500), (1196,1483), (858,1475), (527,1475), (318,1457), (2571,1430), (2028,1405), (2762,1385), (593,1350), (608,1278), (110,1206), (296,1193), (1197,1186), (50,1144), (1210,1028), (1617,1009), (2997,1007), (2396,987))\nhigh_rated: org.apache.spark.rdd.RDD[(Int, Int)] = ParallelCollectionRDD[156] at parallelize at <console>:68\nx: Array[String] = Array(Star Wars: Episode V - The Empire Strikes Back (1980), Shakespeare in Love (1998), Fargo (1996), Saving Private Ryan (1998), Star Wars: Episode IV - A New Hope (1977), Pulp Fiction (1994), Princess Bride, The (1987), L.A. Confidential (1997), Silence of the Lambs, The (1991), Being John Malkovich (1999), Shawshank Redemption, The (1994), Sixth Sense, The (1999), Godfat..."},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":111}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"77CB19B0757D4C26B99E9B2D8978B809"},"cell_type":"code","source":"val movies_arr=toprated.map{\n   case ((movieid,rating),count) => (movieid.toString)\n}\nval age_rated = sc.parallelize(highest_rated_for_age)","outputs":[{"name":"stdout","output_type":"stream","text":"movies_arr: Array[String] = Array(2858, 260, 1198, 1196, 858, 527, 318, 2571, 2028, 2762, 593, 608, 110, 296, 1197, 50, 1210, 1617, 2997, 2396)\r\nage_rated: org.apache.spark.rdd.RDD[Int] = ParallelCollectionRDD[273] at parallelize at <console>:66\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":166}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"12F0FD9517C44C6086318CE6B956BDB5"},"cell_type":"code","source":"val forage = ratings_data.filter(line => movies_arr.exists(line._2.contains) && line._3==5)\nval topmoviesusers=forage.map{\n                              case(userid,movieid,rating,time) => (userid,movieid)\n                            }\n                         ","outputs":[{"name":"stdout","output_type":"stream","text":"forage: org.apache.spark.rdd.RDD[(Int, String, Int, Long)] = MapPartitionsRDD[276] at filter at <console>:63\r\ntopmoviesusers: org.apache.spark.rdd.RDD[(Int, String)] = MapPartitionsRDD[277] at map at <console>:64\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":168}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"648381ADDFA44A5FA5141BC03FAE447D"},"cell_type":"code","source":"val users_data = sparkContext.textFile(\"C:/Users/sanket.patil/Downloads/ml-1m/users.dat\")\n                        .map(line => line.split(\"::\"))\n                        .map(user => (user(0).toInt,user(2).toString))","outputs":[{"name":"stdout","output_type":"stream","text":"users_data: org.apache.spark.rdd.RDD[(Int, String)] = MapPartitionsRDD[281] at map at <console>:55\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":169}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"D66AD51561A341BFAAB5C211CC39B7AF"},"cell_type":"code","source":"val x=topmoviesusers.join(users_data)\nprintln(\"Number of views by young age group of Top rated films \")\nval young= x.filter{\n                case (userid,(movieid,age)) => age.toInt <20 \n}\n      .count\nprintln(\"Number of views by young adult age group of Top rated films \")\nval yadult= x.filter{\n                case (userid,(movieid,age)) => age.toInt >20 && age.toInt <40 \n}\n      .count\nprintln(\"Number of views by adult age group of Top rated films \")\nval adult= x.filter{\n                case (userid,(movieid,age)) => age.toInt <40\n}\n      .count","outputs":[{"name":"stdout","output_type":"stream","text":"Number of views by young age group of Top rated films \nNumber of views by young adult age group of Top rated films \nNumber of views by adult age group of Top rated films \nx: org.apache.spark.rdd.RDD[(Int, (String, String))] = MapPartitionsRDD[284] at join at <console>:70\nyoung: Long = 7938\nyadult: Long = 20243\nadult: Long = 28181\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":170}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false,"id":"8FD09A874D4A450DA7753EA60208EFE5"},"cell_type":"code","source":"println(\"Top 10 bad critics with 40 reviews\")\n\nval bad_critics=ratings_data.map{\n                               case (userid,movieid,rating,time) => ((userid,rating),1)\n                             }\n                         .reduceByKey(_+_) \n                          .filter{\n                             case ((userid,rating),count) => count > 40 && rating==1\n                         }\n                         .sortBy(-_._2)\n                         .map{\n                           case ((userid,rating),count) => (userid) \n                          }\n                         .take(10)\nbad_critics.foreach(println)\n                         ","outputs":[{"name":"stdout","output_type":"stream","text":"Top 10 bad critics with 40 reviews\n4227\n1340\n5795\n3476\n3610\n2106\n1010\n752\n5367\n3589\nbad_critics: Array[Int] = Array(4227, 1340, 5795, 3476, 3610, 2106, 1010, 752, 5367, 3589)\n"},{"metadata":{},"data":{"text/html":""},"output_type":"execute_result","execution_count":172}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true,"id":"FFC95555BA7745E785E3FBAA2BDEC189"},"cell_type":"code","source":"","outputs":[]}],"nbformat":4}